stages: [test, ai_review]

bot-smoketest:
  stage: test
  image: alpine:3.19
  rules:
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
  before_script:
    - apk add --no-cache curl jq
  script:
    # Post a single discussion note to THIS MR
    - 'curl -sS --request POST
        --header "PRIVATE-TOKEN: ${GITLAB_REVIEW_PAT}"
        --header "Content-Type: application/json"
        --data "{\"body\":\"âœ… Bot smoketest: CI can comment on MR !${CI_MERGE_REQUEST_IID}.\"}"
        "${CI_API_V4_URL}/projects/${CI_PROJECT_ID}/merge_requests/${CI_MERGE_REQUEST_IID}/notes"
      | jq -r ".body"'